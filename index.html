<!DOCTYPE html>

<html lang="ja">
<head><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&amp;display=swap" rel="stylesheet"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>éŸ“å›½èªå˜èªæš—è¨˜ãƒ„ãƒ¼ãƒ«</title>
<style>body, header, h1, h2, h3, label, select, button {
  font-family: 'Noto Sans JP', sans-serif;
}

header h1 {
  font-size: 24px;
  margin: 0;
}

body {
  font-family: 'Noto Sans JP', sans-serif;
  background-color: #f9f9fb;
  margin: 0;
  padding: 0;
}
header {
  background-color: #333;
  color: #fff;
  padding: 15px 0;
  text-align: center;
  font-size: 28px;
}
.container {
  max-width: 600px;
  background-color: #fff;
  margin: 40px auto;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
}
h3 {
  margin-top: 15px;
  font-size: 20px;
  border-left: 6px solid #007BFF;
  padding-left: 10px;
}
button {
  display: inline-block;
  margin: 10px 5px 10px 0;
  padding: 12px 24px;
  font-size: 16px;
  font-weight: bold;
  color: #fff;
  background-color: #007BFF;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  transition: all 0.2s ease-in-out;
}
button:hover {
  background-color: #0056b3;
  transform: translateY(-1px);
}
.form-group {
  display: grid;
  grid-template-columns: 100px 1fr;
  align-items: center;
  gap: 10px;
  margin: 10px 0;
}
.form-group label {
  font-size: 14px;
  margin: 0;
  white-space: nowrap;
}
.form-group select {
  padding: 4px 8px;
  font-size: 14px;
}
.page-range {
  display: flex;
  align-items: center;
  gap: 5px;
}
.checkbox-group {
  margin: 10px 0;
}
.checkbox-group label {
  display: flex;
  align-items: center;
  font-size: 14px;
  gap: 5px;
}
select.level-select {
  width: 160px;
}

body {
      font-family: 'Noto Sans JP', sans-serif;
      background-color: #f9f9fb;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #333;
      color: #fff;
      padding: 15px 0;
      text-align: center;
      font-size: 24px;
    }
    .container {
      max-width: 600px;
      background-color: #fff;
      margin: 40px auto;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
    }
    h3 {
      margin-top: 15px;
      font-size: 20px;
      border-left: 6px solid #007BFF;
      padding-left: 10px;
    }
    button {
      display: inline-block;
      margin: 10px 5px 10px 0;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      color: #fff;
      background-color: #007BFF;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: all 0.2s ease-in-out;
    }
    button:hover {
      background-color: #0056b3;
      transform: translateY(-1px);
    }
    .form-group {
      display: grid;
      grid-template-columns: 100px 1fr;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
    }
    .form-group label {
      font-size: 14px;
      margin: 0;
      white-space: nowrap;
    }
    .form-group select {
      padding: 4px 8px;
      font-size: 14px;
    }
    .page-range {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .checkbox-group {
      margin: 10px 0;
    }
    .checkbox-group label {
      display: flex;
      align-items: center;
      font-size: 14px;
      gap: 5px;
    }
    select.level-select {
    width: 160px; /* è¡¨ç¤ºãƒšãƒ¼ã‚¸ã‚»ãƒ¬ã‚¯ãƒˆ2å€‹ï¼‹ï½ã¨åŒã˜ãã‚‰ã„ã®å¹…ã«èª¿æ•´ */
    }

body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }
        header {
            background: #333;
            color: #fff;
            padding: 10px 0;
            text-align: center;
        }
        .container {
            max-width: 600px;
            margin: 40px auto;
            padding: 20px;
            background: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        button {
            display: inline-block;
            margin: 5px 0;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #007BFF;
            color: #fff;
            border: none;
            border-radius: 3px;
        }
        button:hover {
            background: #0056b3;
        }
        .hidden {
            display: none;
        }
        .modal-content button {
            margin: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background: #f4f4f9;
        }
        .scrollable-table {
            max-height: 450px;  /* ãƒ†ãƒ¼ãƒ–ãƒ«ã®æœ€å¤§é«˜ã• */
            overflow-y: auto;   /* ç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’è¨±å¯ */
            border: 1px solid #ddd;
            position: relative;
            padding: 0;
            margin: 0;
            -webkit-overflow-scrolling: touch;  /* iOSã®ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ– */
            touch-action: auto;  /* ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ– */
        }

        .scrollable-table table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
            padding: 0;
        }

        .scrollable-table thead th {
            position: sticky;
            top: 0;
            background-color: #f4f4f4;
            z-index: 2;
            height: 30px;
            line-height: 30px;
        }
        td.green {
            color: green;
            background-color: #d4edda;
        }

        td.red {
            color: red;
            background-color: #f8d7da;
        }
        .hidden-korean {
            visibility: hidden;
        }

        .hidden-meaning {
            visibility: hidden;
        }
        #word-container {
            display: flex;
            align-items: center;
        }

        #word {
            margin-right: 2px; /* ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã¨ã®é–“ã«é©åˆ‡ãªã‚¹ãƒšãƒ¼ã‚¹ã‚’è¿½åŠ  */
        }
        table th, table td {
            height: 20px;   /* å„è¡Œã®é«˜ã•ã‚’50pxã«è¨­å®š */
        }
        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            width: 300px;
        }

        .modal-buttons {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .modal-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #modal-yes {
            background-color: #4CAF50;
            color: white;
        }

        #modal-no {
            background-color: #f44336;
            color: white;
        }
        .button-container {
            display: flex;
            justify-content: center;  /* æ°´å¹³æ–¹å‘ã«ä¸­å¤®æƒãˆ */
            align-items: center;      /* å‚ç›´æ–¹å‘ã«ã‚‚ä¸­å¤®æƒãˆ */
            gap: 10px;
            margin-top: 20px;         /* ãƒœã‚¿ãƒ³ã¨ã‚«ãƒ¼ãƒ‰ã®é–“ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’è¿½åŠ ï¼ˆå¿…è¦ã«å¿œã˜ã¦èª¿æ•´ï¼‰ */
        }


        #correct-btn, #incorrect-btn {
            font-size: 24px;
            width: 170px;            /* å¹…ã‚’é©åˆ‡ã«è¨­å®š */
            height: 50px;           /* é«˜ã•ã‚’é©åˆ‡ã«è¨­å®š */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border-radius: 10px;
            line-height: 1;
            box-sizing: border-box;
        }

        #card {
            width: 100%;
            max-width: 450px;
            height: auto; /* é«˜ã•ã¯å†…å®¹ã«å¿œã˜ã¦å¯å¤‰ */
            margin: 20px auto;
            padding: 20px;
            background-color: #e0e0e0; /* ã‚°ãƒ¬ãƒ¼ã®ã‚«ãƒ¼ãƒ‰è‰² */
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column; /* ç¸¦ã«ä¸¦ã¹ã‚‹ */
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

#word-container {
    display: flex;
    justify-content: center;  /* å˜èªã‚’ä¸­å¤®æƒãˆ */
    align-items: center;
    width: 100%;  /* è¦ªè¦ç´ ã®å¹…ã‚’å‡ç­‰ã« */
}

#word-wrapper {
    display: flex;
    align-items: center;  /* å˜èªã¨ğŸ“¢ã‚’ç¸¦ä¸­å¤®æƒãˆ */
    justify-content: center;  /* ğŸ“¢ãƒãƒ¼ã‚¯ã‚’å˜èªã®å³ã«é…ç½® */
    gap: 8px;  /* å˜èªã¨ğŸ“¢ãƒãƒ¼ã‚¯ã®é–“éš” */
    min-width: 200px;  /* å˜èªã®å¹…ã‚’ä¸€å®šã«ã—ã€æ„å‘³ã¨æƒãˆã‚„ã™ãã™ã‚‹ */
}

#word {
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    white-space: nowrap;  /* é•·ã„å˜èªã§ã‚‚æŠ˜ã‚Šè¿”ã•ãªã„ */
}

#speaker-icon {
    font-size: 20px;
    cursor: pointer;
}

#meaning {
    display: block;
    font-size: 18px;
    color: #555;
    text-align: center;  /* å˜èªã®æ„å‘³ã‚‚ä¸­å¤®æƒãˆ */
    margin-top: 10px;
    min-width: 200px;  /* `#word-wrapper` ã¨åŒã˜å¹…ã‚’è¨­å®š */
}
.progress-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}
/* ã€‡Ã—ãƒœã‚¿ãƒ³ã®ä¸‹ã«é»’ç·šã‚’å¼•ã„ã¦ã€çŸ¢å°ãƒœã‚¿ãƒ³ã‚’é…ç½® */
.button-container {
    display: flex;
    justify-content: center;  /* æ°´å¹³æ–¹å‘ã«ä¸­å¤®æƒãˆ */
    align-items: center;      /* å‚ç›´æ–¹å‘ã«ã‚‚ä¸­å¤®æƒãˆ */
    gap: 10px;
    margin-top: 20px;         /* ãƒœã‚¿ãƒ³ã¨ã‚«ãƒ¼ãƒ‰ã®é–“ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’è¿½åŠ ï¼ˆå¿…è¦ã«å¿œã˜ã¦èª¿æ•´ï¼‰ */
}

/* é»’ç·šã‚’å¼•ããŸã‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.line-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    margin-top: 10px; /* ãƒœã‚¿ãƒ³ã¨é»’ç·šã®é–“ã«ã‚¹ãƒšãƒ¼ã‚¹ */
}

/* é»’ç·š */
.black-line {
    width: 100%;
    height: 2px;
    background-color: rgba(0, 0, 0, 0.1);  /* è–„ã„é»’ç·š */
    margin-bottom: 10px;  /* é»’ç·šã¨çŸ¢å°ãƒœã‚¿ãƒ³ã®é–“ã«ã‚¹ãƒšãƒ¼ã‚¹ */
}

/* çŸ¢å°ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.arrows-container {
    display: flex;
    justify-content: space-between;
    width: 100%;  /* è¦ªè¦ç´ ã„ã£ã±ã„ã«åºƒãŒã‚‹ */
    padding: 0 10px;  /* ä¸¡ç«¯ã«é©åˆ‡ãªä½™ç™½ã‚’è¿½åŠ  */
}
.word-list-controls {
    display: flex;
    justify-content: space-between; /* å·¦å³ã«é…ç½® */
    align-items: center; /* é«˜ã•ã‚’æƒãˆã‚‹ */
    width: 100%; /* æ¨ªå¹…ã„ã£ã±ã„ã«åºƒã’ã‚‹ */
    margin-top: 10px; /* ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã®é–“éš” */
}

.word-list-buttons {
    display: flex;
    gap: 10px; /* ãƒœã‚¿ãƒ³åŒå£«ã®é–“éš” */
}

.word-list-buttons button {
    padding: 5px 10px;
    font-size: 20px;
}
#toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #ff4d4d;
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    font-size: 0.9em;
    z-index: 9999;
    display: none;   /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
    opacity: 0;
    transition: opacity 0.5s ease;
}

#toast.show {
    display: block;
    opacity: 1;
}

    .container {
      max-width: 600px;
      background-color: #fff;
      margin: 40px auto;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
    }
    h3 {
      margin-top: 15px;
      font-size: 20px;
      border-left: 6px solid #007BFF;
      padding-left: 10px;
    }
    .form-group {
      display: grid;
      grid-template-columns: 100px 1fr;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
    }
    .form-group label {
      font-size: 14px;
      margin: 0;
      white-space: nowrap;
    }
    .form-group select {
      padding: 4px 8px;
      font-size: 14px;
    }
    .page-range {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .page-range select {
      width: 60px;
    }
    .level-select {
      width: 160px;
    }
    .checkbox-group {
      margin: 10px 0;
    }
    .checkbox-group label {
      display: flex;
      align-items: center;
      font-size: 14px;
      gap: 5px;
    }
 #word-list-body td:nth-child(1),
#word-list-body td:nth-child(2) {
  text-align: left;
  padding-left: 20px;
}
#word-list table td:nth-child(1),
#word-list table th:nth-child(1) {
  width: 120px;
}

#word-list table td:nth-child(2),
#word-list table th:nth-child(2) {
  width: 270px;
}

#word-list table td:nth-child(3),
#word-list table th:nth-child(3) {
  width: 70px;
}
select {
  max-height: 260px;
  overflow-y: auto;
  display: block;
}

/* å˜èªã‚»ãƒ«ï¼šå·¦ã«å˜èªã€å³ã«ã‚¢ã‚¤ã‚³ãƒ³ */
.word-cell {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  white-space: nowrap;        /* æŠ˜ã‚Šè¿”ã—é˜²æ­¢ï¼ˆå¿…è¦ãªã‚‰ï¼‰ */
}

/* ãƒ†ã‚­ã‚¹ãƒˆå´ï¼ˆæŠ½å‡ºç”¨ã®ãƒ•ãƒƒã‚¯ã«ã‚‚ä½¿ã†ï¼‰ */
.word-text {
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ã‚¢ã‚¤ã‚³ãƒ³ãƒœã‚¿ãƒ³ã‚’æ§ãˆã‚ã«ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã«ã‚‚é…æ…®ã—ã¦buttonåŒ–ï¼‰ */
.icon-btn {
  all: unset;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 22px;
  height: 22px;
  font-size: 0.9em;           /* ğŸ“¢ã‚’å°‘ã—å°ã•ã‚ */
  opacity: 0.45;              /* ç›®ç«‹ã¡ã™ããªã„ */
  cursor: pointer;
  border-radius: 4px;
  transition: opacity 0.15s, transform 0.05s;
}
.word-cell:hover .icon-btn,
.icon-btn:focus-visible {
  opacity: 1;                 /* ãƒ›ãƒãƒ¼/ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã ã‘ã‚¯ãƒƒã‚­ãƒª */
}
.icon-btn:active {
  transform: translateY(1px);
}

/* è¡¨ç¾åŠ›UPãƒ¢ãƒ¼ãƒ‰æ™‚ã«å˜èªä¸€è¦§ã®æ–‡å­—ã‚’å°ã•ãã™ã‚‹ */
#scrollable-table.small-text-mode table {
  font-size: 12px;
}
/* ã‚µãƒãƒªãƒ¼ã®1è¡Œç›®ï¼ˆå·¦ï¼šãƒã‚§ãƒƒã‚¯ç¾¤ï¼å³ï¼šåˆè¨ˆï¼‰ã‚’åŒã˜é«˜ã•ã« */
#word-summary{
  display: grid;
  grid-template-columns: 1fr auto;  /* å·¦ã¯å¯å¤‰ã€å³ã¯å†…å®¹å¹… */
  align-items: center;               /* ç¸¦ä½ç½®ã‚’ä¸­å¤®æƒãˆ */
  row-gap: 6px;                      /* 1è¡Œç›®ã¨ãƒãƒ¼ã®é–“ */
  column-gap: 12px;
  margin-bottom: 0;
}

/* å·¦å´ï¼ˆãƒã‚§ãƒƒã‚¯ï¼‹ãƒ©ãƒ™ãƒ«ï¼‰ */
#word-summary .status-group{
  grid-column: 1 / 2;
  display: flex;
  gap: 14px;
  flex-wrap: wrap;                   /* æ¨ªãŒè¶³ã‚Šãªã‘ã‚Œã°æŠ˜ã‚Šè¿”ã— */
  align-items: center;
  margin: 0;
}

/* å³å´ï¼ˆ/ åˆè¨ˆ XXï¼‰ */
#word-summary .summary-total{
  grid-column: 2 / 3;
  white-space: nowrap;               /* æŠ˜ã‚Šè¿”ã•ãªã„ã§å³ã«å¯„ã›ã‚‹ */
  margin: 0;
}

/* é€²æ—ãƒãƒ¼ã¯2åˆ—ã¶ã¡æŠœãã§2æ®µç›®ã« */
#word-summary .progress-bar{
  grid-column: 1 / 3;
  margin: 2px 0 0 0;
}

.status-item.green { color: #6dbd61; }   /* é»„ç·‘ */
.status-item.red   { color: #e07c7c; }   /* æ·¡ã„èµ¤ */
.status-item.gray  { color: #888; }      /* è–„ç° */
.summary-total     { color: #666; margin-left: auto; }

.progress-bar {
  display: flex;
  width: 100%;
  height: 8px;
  border-radius: 4px;
  overflow: hidden;
  background: #e6e6e6;
}
/* ====== â‘  ä¸Šéƒ¨ã®ç™½ä½™ç™½ã‚’å°ã•ãã™ã‚‹ ====== */

/* ã€Œå˜èªä¸€è¦§ã€ã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚µãƒãƒªãƒ¼ã®é–“ */
#word-list h2 {
  margin-top: 6px !important;  /* ä¸Šã®ç©ºãã‚’æ¸›ã‚‰ã™ */
  margin-bottom: 6px !important;
}

/* ã‚µãƒãƒªãƒ¼å…¨ä½“ã®å¤–å´ãƒãƒ¼ã‚¸ãƒ³ã‚‚æœ€å°åŒ– */
#word-summary {
  margin-top: 0 !important;
  margin-bottom: 0 !important;
}

/* ãƒšãƒ¼ã‚¸å…¨ä½“ã«ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãŒåŠ¹ã„ã¦ã„ã‚‹å ´åˆã«å‚™ãˆã¦è»½ãä¸Šã‚’è©°ã‚ã‚‹ */
#word-list,
#word-list .card,
#word-list .content {
  padding-top: 8px !important;
}
/* ã‚µãƒãƒªãƒ¼1æ®µç›®ï¼ˆãƒã‚§ãƒƒã‚¯ç¾¤ã¨åˆè¨ˆï¼‰â†’ãƒãƒ¼â†’è¡¨ã€ã®ç¸¦ã‚®ãƒ£ãƒƒãƒ—æœ€å°åŒ– */
#word-summary { margin-bottom: 0 !important; }
#word-summary .status-group { margin: 0 !important; line-height: 1.2; }
#word-summary .summary-total { margin: 0 !important; }
#word-summary .progress-bar { margin: 4px 0 6px 0 !important; }

/* ãƒãƒ¼ã®è§’ä¸¸ã‚’ç¶ºéº—ã«å‡ºã™ */
#word-summary .progress-bar {
  height: 8px;
  border-radius: 6px;
  overflow: hidden;                /* è§’ä¸¸ã‚’å­è¦ç´ ã«é©ç”¨ */
  background: #e6e6e6;
}
#word-summary .progress-bar .bar { border-radius: 0; }

/* ãƒãƒ¼ç›´å¾Œã®è¦ç´ ï¼ˆåŒºåˆ‡ã‚Šç·šã‚„ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ©ãƒƒãƒ‘ï¼‰ã®ä¸Šä½™ç™½ã‚’æ½°ã™ */
#word-summary + * { margin-top: 0 !important; }

/* è¡¨ã‚³ãƒ³ãƒ†ãƒŠå´ã®ä½™ç™½ã‚’ã‚¼ãƒ­ã« */
#scrollable-table { margin-top: 0 !important; }

/* ãƒ˜ãƒƒãƒ€ã¨ã®éš™é–“ã‚’ãªãã™ï¼ˆtableã®ä»•æ§˜ã§ç”Ÿã¾ã‚Œã‚‹éš™é–“å¯¾ç­–ï¼‰ */
#scrollable-table table {
  border-collapse: collapse;       /* ã“ã‚Œã§å¢ƒç•Œã®ã‚¹ã‚­ãƒãŒæ¶ˆãˆã‚‹ */
  border-spacing: 0;
}
.bar { height: 100%; transition: width 0.3s; }
.bar.green { background: #9ed993; }  /* æ˜ã‚‹ã„é»„ç·‘ */
.bar.red   { background: #f1b0b0; }  /* æ·¡ã„èµ¤ */
.bar.gray  { background: #cfcfcf; }  /* è–„ç° */


/* åˆ—ã®ä¸€æ‹¬éè¡¨ç¤ºï¼ˆã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ãŸã‚ display:none ã¯ä½¿ã‚ãªã„ï¼‰ */
.hide-col-word    td.col-word,
.hide-col-meaning td.col-meaning {
  opacity: 0;                     /* è¦‹ãˆãªãã™ã‚‹ */
  cursor: pointer;                /* è§¦ã‚Œã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã‚ˆã†ã« */
  transition: opacity .12s;
  position: relative;
}

/* ãƒ’ãƒ³ãƒˆï¼ˆã†ã£ã™ã‚‰ç‚¹ç·šèƒŒæ™¯ï¼‰ï¼šä¸è¦ãªã‚‰æ¶ˆã—ã¦OK */
.hide-col-word    td.col-word::after,
.hide-col-meaning td.col-meaning::after {
  content: ''; position: absolute; inset: 6px;
  background-image: radial-gradient(#ddd 1px, transparent 1px);
  background-size: 6px 6px;
  opacity: .5; pointer-events: none;
}

/* ã‚»ãƒ«å€‹åˆ¥ã®å†è¡¨ç¤ºï¼ˆpeekï¼‰ */
td.peek-cell { 
  opacity: 1 !important;          /* åˆ—ãŒéš ã‚Œã¦ã„ã¦ã‚‚ã“ã®ã‚»ãƒ«ã ã‘è¦‹ãˆã‚‹ */
}

</style>
</head>
<body>
<header>
<h1>éŸ“å›½èªå˜èªæš—è¨˜ãƒ„ãƒ¼ãƒ«</h1>
</header>
<div class="container">
<!-- å‡ºé¡Œç¯„å›²é¸æŠ -->
<div class="section" id="range-selection"><h3>ğŸ“‹ å˜èªä¸€è¦§è¡¨ç¤º</h3><button id="word-list-show-btn">å˜èªä¸€è¦§ã‚’è¦‹ã‚‹</button>
<div class="form-group">
<label for="wordlist-level-select">é›£æ˜“åº¦:</label>
<select class="level-select" id="wordlist-level-select">
<option value="beginner">åˆç´š</option>
<option value="intermediate">ä¸­ç´š</option>
<option value="advanced">ä¸Šç´š</option>
<option value="expressionup">è¡¨ç¾åŠ›UP</option>
<option value="Level4">èªå­¦å ‚4ç´šå˜èª</option>
<option value="Level5">èªå­¦å ‚5ç´šå˜èª</option>
</select>
</div>
<div class="form-group">
<label>è¡¨ç¤ºãƒšãƒ¼ã‚¸:</label>
<div class="page-range">
<select id="wordlist-start-page"></select>
<span>ï½</span>
<select id="wordlist-end-page"></select>
</div>
</div>
<div class="checkbox-group">
<label><input id="wordlist-shuffle" type="checkbox"/> å˜èªã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã³æ›¿ãˆã¦è¡¨ç¤º</label>
</div>
<h3>ğŸƒ ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰å‡ºé¡Œ</h3><button onclick="startQuiz()">ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰é–‹å§‹</button>
<div class="form-group">
<label for="quiz-level-select">é›£æ˜“åº¦:</label>
<select class="level-select" id="quiz-level-select">
<option value="beginner">åˆç´š</option>
<option value="intermediate">ä¸­ç´š</option>
<option value="advanced">ä¸Šç´š</option>
<option value="expressionup">è¡¨ç¾åŠ›UP</option>
<option value="Level4">èªå­¦å ‚4ç´šå˜èª</option>
<option value="Level5">èªå­¦å ‚5ç´šå˜èª</option>
</select>
</div>
<div class="form-group">
<label>å‡ºé¡Œãƒšãƒ¼ã‚¸:</label>
<div class="page-range">
<select id="start-page"></select>
<span>ï½</span>
<select id="end-page"></select>
</div>
</div>
<div class="checkbox-group">
<label><input id="only-incorrect" type="checkbox"/> æœªæš—è¨˜ã®ã¿å‡ºé¡Œ</label>
<label><input id="auto-speak" onchange="toggleAutoSpeak()" type="checkbox"/> éŸ³å£°å†ç”ŸON</label>
</div>
<div>
<button onclick="exportProgress()">æš—è¨˜çŠ¶æ³ã‚’ä¿å­˜</button>
<input accept=".json" id="import-file" onchange="importProgress(event)" style="display:none;" type="file"/>
<button onclick="document.getElementById('import-file').click()">æš—è¨˜çŠ¶æ³ã‚’èª­ã¿è¾¼ã‚€</button>
<div id="toast" style="
  display: none;
  position: fixed;
  top: 20px;
  right: 20px;
  background-color: #ff4d4d;
  color: white;
  padding: 10px 20px;
  border-radius: 5px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  font-size: 0.9em;
  z-index: 9999;
  opacity: 0;
  transition: opacity 0.5s ease;
"></div>
</div>
</div>
<!-- å‡ºé¡Œã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
<div class="section hidden" id="quiz-section">
<!-- é€²è¡ŒçŠ¶æ³ã¨æˆ»ã‚‹ãƒœã‚¿ãƒ³ã‚’æ¨ªä¸¦ã³ã«ã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ãƒ†ãƒŠ -->
<div class="progress-container">
<span>é€²è¡ŒçŠ¶æ³: <span id="progress">0/0</span></span>
<button onclick="showRangeSelection()">ğŸ ãƒ›ãƒ¼ãƒ </button>
</div>
<div id="card">
<div id="word-container">
<div id="word-wrapper">
<span id="word">ã“ã“ã«å˜èªãŒè¡¨ç¤ºã•ã‚Œã¾ã™</span>
<span id="speaker-icon" onclick="playWord(document.getElementById('word').textContent)">ğŸ“¢</span>
</div>
</div>
<div id="meaning">ï¼ˆæ„å‘³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</div>
</div>
<div class="button-container">
<button id="incorrect-btn" onclick="markAnswer(false)">Ã—</button>
<button id="correct-btn" onclick="markAnswer(true)">âšªï¸</button>
<button id="next-btn" onclick="nextQuestion()" style="display: none;">æ¬¡ã¸</button>
</div>
<!-- ã“ã“ã«é»’ç·šã¨çŸ¢å°ãƒœã‚¿ãƒ³ã‚’é…ç½® -->
<div class="line-container">
<div class="black-line"></div> <!-- è–„ã„é»’ç·š -->
<div class="arrows-container">
<button id="prev-btn" onclick="moveToPrevious()">â†</button>
<button id="next-btn" onclick="moveToNext()">â†’</button>
</div>
</div>
<p id="result"></p>
</div>
<!-- å˜èªä¸€è¦§è¡¨ç¤º -->
<div class="table-container hidden" id="word-list">
<h2>å˜èªä¸€è¦§</h2>
<!-- å˜èªé€²æ—ã‚µãƒãƒªãƒ¼ -->
<div id="word-summary" class="word-summary">
  <div class="status-group">
    <label class="status-item green">
      <input type="checkbox" id="hide-correct" >
      æš—è¨˜æ¸ˆ <b>0</b>
    </label>
    <label class="status-item red">
      <input type="checkbox" id="hide-incorrect" >
      æœªæš—è¨˜ <b>0</b>
    </label>
    <label class="status-item gray">
      <input type="checkbox" id="hide-unattempted" >
      æœªè§£ç­” <b>0</b>
    </label>
  </div>
  <div class="summary-total">
    / åˆè¨ˆ <b>0</b>
  </div>
  <div class="progress-bar">
    <div id="bar-done" class="bar green"></div>
    <div id="bar-not" class="bar red"></div>
    <div id="bar-none" class="bar gray"></div>
  </div>
</div>
<div class="scrollable-table" id="scrollable-table" tabindex="0">
<table>
<thead>
<tr>
<th>
                                å˜èª
                                <label>
<input id="toggle-korean" onchange="toggleKorean()" type="checkbox"/> 
                                </label>
</th>
<th>
                                æ„å‘³
                                <label>
<input id="toggle-meaning" onchange="toggleMeaning()" type="checkbox"/> 
                                </label>
</th>
<th>æš—è¨˜çŠ¶æ³</th>
</tr>
</thead>
<tbody id="word-list-body">
<!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹å†…å®¹ -->
</tbody>
</table>
</div>
<div class="word-list-controls">
<button onclick="showRangeSelection()">ğŸ ãƒ›ãƒ¼ãƒ </button>
<div class="word-list-buttons">
<button id="up-button" onclick="playPreviousWord()">â†‘</button>
<button id="down-button" onclick="playNextWord()">â†“</button>
<button id="repeat-button" onclick="repeatLastWord()">â™»ï¸</button>
</div>
</div>
</div>
<!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal hidden" id="quiz-modal">
<div class="modal-content">
<p id="modal-message">å‰å›é€”ä¸­ã§çµ‚äº†ã—ãŸã‚¯ã‚¤ã‚ºãŒã‚ã‚Šã¾ã™ã€‚å†é–‹ã—ã¾ã™ã‹ï¼Ÿâ€»Noã‚’é¸æŠã™ã‚‹ã¨å±¥æ­´ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚</p>
<div class="modal-buttons">
<button id="modal-no">No</button>
<button id="modal-yes">Yes</button>
</div>
</div>
</div>
<div class="hidden" id="toast"></div><div class="hidden" id="json-output" style="margin-top:20px;"><p>ğŸ”’ é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚’ä¸‹ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦ã€ãƒ¡ãƒ¢å¸³ã‚„iCloud Driveã«è²¼ã‚Šä»˜ã‘ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚</p><textarea id="json-text" readonly="" rows="10" style="width:100%; font-family: monospace; font-size:14px;"></textarea><button onclick="copyToClipboard()" style="margin-top: 10px;">ã‚³ãƒ”ãƒ¼ã™ã‚‹</button></div>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js').then(() => {
      console.log("Service Worker registered");
    });
  });
}
</script>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4CAF50">
<script src="words.js"></script>
<script>
// ---------------------- åŸºæœ¬çŠ¶æ…‹ ----------------------
let completed = false;
let selectedList = []; // â† åˆæœŸé¸æŠã¯å¾Œã§DOMèª­ã¿è¾¼ã¿å¾Œã«æ±ºã‚ã‚‹

// å˜èªé…åˆ—ãƒãƒƒãƒ—ï¼ˆå­˜åœ¨ã™ã‚‹é…åˆ—åã«åˆã‚ã›ã¦ã“ã“ã ã‘æ•´å‚™ï¼‰
const WORD_MAP = {
  beginner:      beginnerWords,
  intermediate:  intermediateWords,
  advanced:      advancedWords,
  expressionup:  expressionUpWords,
  Level4:        Level4ofkoreanschool,
  Level5:        Level5ofkoreanschool,
};

// å‡ºé¡Œç”¨ï¼šç¾åœ¨ã® selectedList ã‹ã‚‰ç¯„å›²æŠ½å‡º
function getWordsInRange(start, end, onlyIncorrect) {
  return selectedList.filter(w =>
    w.page >= start && w.page <= end &&
    (!onlyIncorrect || w.status === "æœªæš—è¨˜")
  );
}

// ---------------------- ãƒ¬ãƒ™ãƒ«é¸æŠã¨ãƒªã‚¹ãƒˆæ±ºå®š ----------------------
function setWordList(listType) {
  // å®‰å…¨ã«ç¾åœ¨ã®ãƒ¬ãƒ™ãƒ«é…åˆ—ã‚’å–å¾—
  const base = WORD_MAP[listType] || [];
  // ç›´æ¥æ›¸ãæ›ãˆé˜²æ­¢ã®ãŸã‚ã‚³ãƒ”ãƒ¼
  selectedList = base.map(w => ({ ...w }));

  // è¡¨ç¾åŠ›UPã ã‘ãƒ•ã‚©ãƒ³ãƒˆå°ã•ã‚
  const tableContainer = document.getElementById('scrollable-table');
  if (tableContainer) {
    tableContainer.classList.toggle('small-text-mode', listType === 'expressionup');
  }

  // ï¼ˆå˜èªä¸€è¦§ã‚„ã‚¯ã‚¤ã‚ºé–‹å§‹ã®æ™‚ç‚¹ã§ã“ã® selectedList ãŒä½¿ã‚ã‚Œã¾ã™ï¼‰
}

// ---------------------- ãƒšãƒ¼ã‚¸ã‚»ãƒ¬ã‚¯ãƒˆã®ç”Ÿæˆ ----------------------
function maxPageOf(list) {
  return list.reduce((m, w) => Math.max(m, Number(w.page) || 1), 1);
}

// ã‚ã‚‹ãƒ¬ãƒ™ãƒ«ã®æœ€å¤§ãƒšãƒ¼ã‚¸æ•°ã‹ã‚‰ã€æŒ‡å®šã® select ã‚’ 1..max ã§ä½œã‚Šç›´ã™
function rebuildSelectOptions(selectId, max) {
  const sel = document.getElementById(selectId);
  if (!sel) return;
  sel.innerHTML = '';
  const frag = document.createDocumentFragment();
  for (let p = 1; p <= max; p++) {
    const opt = document.createElement('option');
    opt.value = String(p);
    opt.textContent = String(p);
    frag.appendChild(opt);
  }
  sel.appendChild(frag);
}

// å·¦å³ãƒªãƒ³ã‚¯ï¼šå·¦ã‚’å¤‰ãˆãŸã‚‰å³ã®å€™è£œã‚’â€œå·¦ä»¥ä¸Šã®ã¿â€ã«å†æ§‹ç¯‰ã—ã€å€¤ã‚‚åŒæœŸ
function linkStartEnd(startId, endId) {
  const s = document.getElementById(startId);
  const e = document.getElementById(endId);
  if (!s || !e) return;

  // ã™ã§ã«ãƒªãƒ³ã‚¯æ¸ˆã¿ãªã‚‰ã€å³å€™è£œã®æ›´æ–°ã ã‘ã—ã¦çµ‚äº†
  if (s._linkedTo === endId && e._linkedFrom === startId) {
    // æœ€æ–°ã®å…¨å€™è£œã‚’æ’®ã‚Šç›´ã—
    e._allOptions = Array.from(e.options).map(o => o.cloneNode(true));
    // å·¦ä»¥ä¸Šã«çµã£ã¦å€¤ã‚‚æƒãˆã‚‹
    const startVal = parseInt(s.value, 10);
    e.innerHTML = '';
    const frag = document.createDocumentFragment();
    e._allOptions.forEach(opt => {
      const v = parseInt(opt.value, 10);
      if (isNaN(v) || v >= startVal) frag.appendChild(opt.cloneNode(true));
    });
    e.appendChild(frag);
    if (parseInt(e.value, 10) < startVal) e.value = String(startVal);
    return;
  }

  // åˆå›ãƒªãƒ³ã‚¯
  s._linkedTo = endId;
  e._linkedFrom = startId;

  // å³ã®å…¨<option>ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ
  e._allOptions = Array.from(e.options).map(o => o.cloneNode(true));

  const rebuildRight = () => {
    const startVal = parseInt(s.value, 10);
    if (isNaN(startVal)) return;
    e.innerHTML = '';
    const frag = document.createDocumentFragment();
    e._allOptions.forEach(opt => {
      const v = parseInt(opt.value, 10);
      if (isNaN(v) || v >= startVal) frag.appendChild(opt.cloneNode(true));
    });
    e.appendChild(frag);
    const endVal = parseInt(e.value, 10);
    if (isNaN(endVal) || endVal < startVal) e.value = String(startVal);
  };

  s.addEventListener('change', () => {
    if (document.activeElement === e) return; // å³ã‚’é–‹ã„ã¦ã„ã‚‹æœ€ä¸­ã¯é–‰ã˜ã•ã›ãªã„
    rebuildRight();
  });

  // åˆæœŸåŒæœŸ
  rebuildRight();
}

// ãƒ¬ãƒ™ãƒ«ã‚»ãƒ¬ã‚¯ã‚¿ã®å€¤ã‹ã‚‰ã€ãã®ãƒšã‚¢ï¼ˆé–‹å§‹/çµ‚äº†ï¼‰ã‚’ä½œã‚Šç›´ã™
function populatePageSelectorsFor(levelSelectId, startId, endId) {
  const lvSel = document.getElementById(levelSelectId);
  if (!lvSel) return;
  const level = lvSel.value;
  const list = WORD_MAP[level] || [];
  const max = maxPageOf(list);

  rebuildSelectOptions(startId, max);
  rebuildSelectOptions(endId,   max);

  // å·¦å³ãƒªãƒ³ã‚¯ï¼ˆå·¦ä»¥ä¸Šã®ã¿è¡¨ç¤ºï¼‹å€¤åŒæœŸï¼‰
  linkStartEnd(startId, endId);
}

// ---------------------- èµ·å‹•æ™‚ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— ----------------------
document.addEventListener('DOMContentLoaded', () => {
  // ãã‚Œãã‚Œã®ãƒ¬ãƒ™ãƒ«ã‚»ãƒ¬ã‚¯ãƒˆã§ãƒšãƒ¼ã‚¸é¸æŠè‚¢ã‚’ç”Ÿæˆ
  populatePageSelectorsFor('wordlist-level-select', 'wordlist-start-page', 'wordlist-end-page');
  populatePageSelectorsFor('quiz-level-select',     'start-page',           'end-page');

  // ãƒ¬ãƒ™ãƒ«å¤‰æ›´æ™‚ã«ãƒšãƒ¼ã‚¸é¸æŠè‚¢ã‚’ä½œã‚Šç›´ã™ï¼ˆç´šã”ã¨ã®æœ€å¤§ãƒšãƒ¼ã‚¸æ•°ã«åˆã‚ã›ã‚‹ï¼‰
  const wlLevel = document.getElementById('wordlist-level-select');
  wlLevel && wlLevel.addEventListener('change', () => {
    populatePageSelectorsFor('wordlist-level-select', 'wordlist-start-page', 'wordlist-end-page');
    // å˜èªä¸€è¦§ç”¨ã¨ã—ã¦ selectedList ã‚‚æ›´æ–°
    setWordList(wlLevel.value);
  });

  const qLevel = document.getElementById('quiz-level-select');
  qLevel && qLevel.addEventListener('change', () => {
    populatePageSelectorsFor('quiz-level-select', 'start-page', 'end-page');
    // ã‚¯ã‚¤ã‚ºç”¨ã«ã‚‚ selectedList ã‚’ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§åˆ‡ã‚Šæ›¿ãˆãŸã„ãªã‚‰â†“ã‚’æœ‰åŠ¹åŒ–
    // setWordList(qLevel.value);
  });

  // åˆæœŸ selectedListï¼ˆå˜èªä¸€è¦§ã®æ–¹ã®ãƒ¬ãƒ™ãƒ«ã«åˆã‚ã›ã‚‹ï¼‰
  if (wlLevel) setWordList(wlLevel.value);
});


        // å‡ºé¡Œç¯„å›²ã«åŸºã¥ãå˜èªãƒªã‚¹ãƒˆã‚’å–å¾—
function getWordsInRange(start, end, onlyIncorrect) {
    return selectedList.filter(word => word.page >= start && word.page <= end && (!onlyIncorrect || word.status === "æœªæš—è¨˜"));
}

// ã‚¯ã‚¤ã‚ºé€²è¡ŒçŠ¶æ…‹ã®ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ 
let isQuizInProgress = false;

function showQuizModal(message, onConfirm, onCancel) {
    const modal = document.getElementById("quiz-modal");
    const modalMessage = document.getElementById("modal-message");
    const yesButton = document.getElementById("modal-yes");
    const noButton = document.getElementById("modal-no");

    modalMessage.textContent = message;
    modal.classList.remove("hidden");

    // ã€Œå†é–‹ã€ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    yesButton.onclick = () => {
        modal.classList.add("hidden");
        onConfirm();
    };

    // ã€Œæ–°ã—ã„ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹ã€ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    noButton.onclick = () => {
        modal.classList.add("hidden");
        onCancel();
    };
}

function startQuiz() {
    const startPage = parseInt(document.getElementById("start-page").value);
    const endPage = parseInt(document.getElementById("end-page").value);
    const onlyIncorrect = document.getElementById("only-incorrect").checked;
    const isBeginner = document.getElementById("quiz-level-select").value === "beginner"; // åˆç´šé¸æŠãƒœã‚¿ãƒ³ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

	const selectedLevel = document.getElementById("quiz-level-select").value;
	setWordList(selectedLevel);

    if (startPage > endPage) {
        alert("é–‹å§‹ãƒšãƒ¼ã‚¸ã¯çµ‚äº†ãƒšãƒ¼ã‚¸ä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ã€‚");
        return;
    }

    // ã‚¯ã‚¤ã‚ºé€²è¡ŒçŠ¶æ³ã‚’å¾©å…ƒã™ã‚‹ã‹ã€æ–°ã—ãé–‹å§‹ã™ã‚‹ã‹ç¢ºèª
    const savedQuizState = localStorage.getItem("quizProgress");
    if (completed) {
    // çµ‚äº†ãƒ•ãƒ©ã‚°ãŒç«‹ã£ã¦ã„ã‚‹å ´åˆã¯ã€ç¢ºèªã›ãšã«å¼·åˆ¶çš„ã«æ–°ã—ã„ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹
    startNewQuiz();
    } else if (savedQuizState) {
        showQuizModal(
            "å‰å›é€”ä¸­ã§çµ‚äº†ã—ãŸã‚¯ã‚¤ã‚ºãŒã‚ã‚Šã¾ã™ã€‚å†é–‹ã—ã¾ã™ã‹ï¼Ÿ",
            () => {
                // å†é–‹å‡¦ç†
                loadQuizProgress();
                isQuizInProgress = true;
                showQuizSection();
                nextQuestion();
            },
            () => {
                // æ–°ã—ã„ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹
                startNewQuiz();
            }
        );
    } else {
        // æ–°ã—ã„ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹
        startNewQuiz();
    }
}
// æ–°ã—ã„ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹ã™ã‚‹é–¢æ•°
function startNewQuiz() {
    completed = false; // çµ‚äº†ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ
    const startPage = parseInt(document.getElementById("start-page").value);
    const endPage = parseInt(document.getElementById("end-page").value);
    const onlyIncorrect = document.getElementById("only-incorrect").checked;
    const isBeginner = document.getElementById("quiz-level-select").value === "beginner"; // åˆç´šé¸æŠãƒœã‚¿ãƒ³ãŒãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
    
    loadAnswersFromStorage();
    quizWords = getWordsInRange(startPage, endPage, onlyIncorrect);

    if (quizWords.length === 0) {
        alert("é¸æŠç¯„å›²å†…ã«å˜èªãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
        return;
    }

    quizWords = shuffleArray(quizWords);
    currentQuizIndex = 0;
    isQuizInProgress = true;

    // é€²è¡ŒçŠ¶æ³ã‚’åˆæœŸåŒ–
    updateProgress();

    showQuizSection();
    nextQuestion();
}
	function shuffleArray(array) {
    	    for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1)); // ãƒ©ãƒ³ãƒ€ãƒ ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ç”Ÿæˆ
                [array[i], array[j]] = [array[j], array[i]]; // è¦ç´ ã‚’äº¤æ›
    	    }
    	return array;
	}

        let quizWords = [];
        let currentQuizIndex = 0;

function endQuiz() {
    alert("ã‚¯ã‚¤ã‚ºãŒçµ‚äº†ã—ã¾ã—ãŸï¼");

    // ã‚¯ã‚¤ã‚ºé€²è¡ŒçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
    isQuizInProgress = false;
    quizWords = [];
    currentQuizIndex = 0;

    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰é€²è¡ŒçŠ¶æ³ã‚’å‰Šé™¤
    localStorage.removeItem("quizProgress");

    // ã‚¯ã‚¤ã‚ºã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤ºã«ã—ã¦ç¯„å›²é¸æŠç”»é¢ã«æˆ»ã‚‹
    showRangeSelection();
}

// å›ç­”çµæœã‚’ä¿å­˜
function saveAnswer(word, status) {
    let storedAnswers = JSON.parse(localStorage.getItem('quizAnswers')) || [];
    const existingAnswerIndex = storedAnswers.findIndex(a => a.word === word.word);
    if (existingAnswerIndex >= 0) {
        storedAnswers[existingAnswerIndex].status = status;
    } else {
        storedAnswers.push({ word: word.word, status: status });
    }
    localStorage.setItem('quizAnswers', JSON.stringify(storedAnswers));
}

// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰è§£ç­”ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã€wordsé…åˆ—ã«åæ˜ 
function loadAnswersFromStorage() {
    const storedAnswers = JSON.parse(localStorage.getItem('quizAnswers')) || [];
    selectedList.forEach(word => {
        const storedAnswer = storedAnswers.find(a => a.word === word.word);
        if (storedAnswer) {
            word.status = storedAnswer.status; // æ­£è§£ã€ä¸æ­£è§£ã€æœªå›ç­”ã®çŠ¶æ…‹ã‚’é©ç”¨
        }
    });
}

// è‡ªå‹•èª­ã¿ä¸Šã’æ©Ÿèƒ½ã®çŠ¶æ…‹ã‚’ãƒˆã‚°ãƒ«ã™ã‚‹é–¢æ•°
function toggleAutoSpeak() {
    return document.getElementById("auto-speak").checked;
}
function markAnswer(isCorrect) {
    const word = quizWords[currentQuizIndex]; // ç¾åœ¨ã®å˜èª
    const resultElement = document.getElementById("result");

    // æ„å‘³ã‚’è¡¨ç¤ºã™ã‚‹
    document.getElementById('meaning').style.display = 'inline';

    // ã€Œæ¬¡ã¸ã€ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹
    document.getElementById('next-btn').style.display = 'block';
    // ã€‡Ã—ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
    document.getElementById('incorrect-btn').style.display = "none";
    document.getElementById('correct-btn').style.display = "none";

    // æ­£è§£ãƒ»ä¸æ­£è§£ã®åˆ¤å®šå‡¦ç†
    if (isCorrect) {
        resultElement.style.color = "green";
        word.status = "æš—è¨˜æ¸ˆ"; 
    } else {
        resultElement.style.color = "red";
        word.status = "æœªæš—è¨˜"; 
    }
    // **ã“ã“ã§ currentQuizIndex ã‚’æ›´æ–°**
    currentQuizIndex++; // æ¬¡ã®å•é¡Œã¸é€²ã‚€

    saveAnswer(word, word.status); // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ä¿å­˜

    // é€²è¡ŒçŠ¶æ³ã®æ›´æ–°
    updateProgress();

    // 1ç§’å¾Œã«æ¬¡ã®å•é¡Œã¸ç§»å‹•ã™ã‚‹å‡¦ç†ã‚’ã‚»ãƒƒãƒˆï¼ˆã€‡ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸå ´åˆã¯è‡ªå‹•ã§ç§»å‹•ï¼‰
    if (isCorrect) {
        autoNextTimeout = setTimeout(() => {
            nextQuestion(); // ã“ã“ã‚’ showNextWord() ã§ã¯ãªã nextQuestion() ã«ã™ã‚‹
        }, 1000);
    }
}
// ä¸€ã¤å‰ã®å•é¡Œã«ç§»å‹•
function moveToPrevious() {
    if (currentQuizIndex > 0) {
        currentQuizIndex--;
        nextQuestion();  // æ¬¡ã®å•é¡Œã«é€²ã‚€å‡¦ç†ã‚’å‘¼ã³å‡ºã™
    }
}

// ä¸€ã¤æ¬¡ã®å•é¡Œã«ç§»å‹•
function moveToNext() {
    if (currentQuizIndex < quizWords.length - 1) {
        currentQuizIndex++;
        nextQuestion();  // æ¬¡ã®å•é¡Œã«é€²ã‚€å‡¦ç†ã‚’å‘¼ã³å‡ºã™
    }
}

let currentWord = 0; // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ã®ç¾åœ¨ã®å˜èªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’åˆæœŸåŒ–
let autoNextTimeout;  // 1ç§’å¾Œã®è‡ªå‹•ç§»å‹•å‡¦ç†ã‚’ç®¡ç†ã™ã‚‹å¤‰æ•°

// æ¬¡ã®å•é¡Œã«é€²ã‚€
function nextQuestion() {
    clearTimeout(autoNextTimeout);  // 1ç§’å¾Œã®è‡ªå‹•ç§»å‹•ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«

    // ã‚¯ã‚¤ã‚ºãŒçµ‚äº†ã—ãŸå ´åˆã€æœ€å¾Œã®å•é¡Œã®å‡¦ç†ã‚’è¡Œã†
    if (currentQuizIndex >= quizWords.length) {
        alert("ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰çµ‚äº†ï¼");
        completed = true;  // çµ‚äº†çŠ¶æ…‹ã‚’ç¤ºã™ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
        showRangeSelection(); // ç¯„å›²é¸æŠç”»é¢ã«æˆ»ã‚‹
        return;
    }

    speechSynthesis.cancel();
    if (speechTimeoutId) {
        clearTimeout(speechTimeoutId);
        speechTimeoutId = null;
    }

    // ç¾åœ¨ã®å˜èªã‚’è¨­å®š
    const word = quizWords[currentQuizIndex]; 
    document.getElementById("word").innerHTML = word.word;
    document.getElementById("meaning").innerHTML = word.meaning;
    document.getElementById('meaning').style.display = "none"; 
    document.getElementById("result").innerHTML = "";

    // ã€Œã€‡Ã—ã€ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
    document.getElementById("incorrect-btn").style.display = "inline-block";
    document.getElementById("correct-btn").style.display = "inline-block";
    document.getElementById("next-btn").style.display = "none"; // æ¬¡ã¸ãƒœã‚¿ãƒ³éè¡¨ç¤º

    saveQuizProgress();
    updateProgress();  // é€²è¡ŒçŠ¶æ³ã‚’æ›´æ–°

    // è‡ªå‹•èª­ã¿ä¸Šã’æ©Ÿèƒ½ãŒã‚ªãƒ³ãªã‚‰å˜èªã‚’2å›èª­ã¿ä¸Šã’
    if (toggleAutoSpeak()) {
        playWord(word.word);

        // 2å›ç›®ã®å†ç”Ÿã‚¿ã‚¤ãƒãƒ¼ã‚’è¨­å®š
//        speechTimeoutId = setTimeout(() => {
//            if (currentQuizIndex === quizWords.indexOf(word)) {
//                playWord(word.word);
//            }
//        }, 2500);
    }
}

// é€²è¡ŒçŠ¶æ³ã®æ›´æ–°
function updateProgress() {
    const totalQuestions = quizWords.length;
    const answeredQuestions = currentQuizIndex + 1; // é€²è¡ŒçŠ¶æ³ã®è¡¨ç¤ºã¯1ã‹ã‚‰ã‚«ã‚¦ãƒ³ãƒˆ
    const progressText = `${answeredQuestions}/${totalQuestions}`;
    
    document.getElementById('progress').textContent = progressText; // é€²è¡ŒçŠ¶æ³ã‚’è¡¨ç¤º
}

// ã€Œæˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸéš›ã®å‡¦ç†
function showRangeSelection() {
    hideAllSections();
    document.getElementById("range-selection").classList.remove("hidden");

    // ã‚¯ã‚¤ã‚ºé€²è¡Œä¸­ã§ã‚‚å˜èªãƒªã‚¹ãƒˆã‚„é€²æ—ã¯ãƒªã‚»ãƒƒãƒˆã—ãªã„
}
function saveQuizProgress() {
    const quizState = {
        currentQuizIndex: currentQuizIndex,
        quizWords: quizWords
    };
    localStorage.setItem("quizProgress", JSON.stringify(quizState));
}

function loadQuizProgress() {
    const quizState = JSON.parse(localStorage.getItem("quizProgress"));
    if (quizState) {
        quizWords = quizState.quizWords || [];
        currentQuizIndex = quizState.currentQuizIndex || 0;
    } else {
        quizWords = [];
        currentQuizIndex = 0;
    }
}
document.body.addEventListener("click", () => {
    const dummy = new Audio();
    dummy.play().catch(() => {});
}, { once: true });
// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ï¼šæœ€å¾Œã«å†ç”Ÿã•ã‚ŒãŸå˜èª
let lastPlayedWord = "";
let speechTimeoutId; // éŸ³å£°å†ç”Ÿã‚¿ã‚¤ãƒãƒ¼ã®ID  
let currentWordIndex = 0; // ç¾åœ¨ã®å†ç”Ÿå¯¾è±¡å˜èªã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹  
let isAudioUnlocked = false; // ãƒ–ãƒ©ã‚¦ã‚¶ã®éŸ³å£°å†ç”ŸãŒè¨±å¯ã•ã‚ŒãŸã‹ã©ã†ã‹
let isPlaying = false; // ç¾åœ¨ã®éŸ³å£°å†ç”ŸçŠ¶æ…‹
let currentAudio = null;

function playWord(word) {
	if (!word) {
        alert("å˜èªãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
        return;
    }
	    // æ—¢å­˜ã®å†ç”ŸãŒã‚ã‚Œã°æ­¢ã‚ã‚‹
    if (currentAudio) {
        currentAudio.pause();
        currentAudio.currentTime = 0;
        currentAudio = null;
    }

  const url = `https://ojaajo-sound.vercel.app/api/tts?text=${encodeURIComponent(word)}`;
  const audio = new Audio(url);

	  audio.play().then(() => {
	    lastPlayedWord = word;
	}).catch((err) => {
	    console.error("éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼:", err);
	    showToast("âš ï¸ éŸ³å£°ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
	});
}

document.addEventListener("keydown", function(event) {
    if (event.shiftKey) {
        if (event.key === "ArrowUp" || event.key === "ArrowDown") {
            if (currentWordIndex >= 0 && currentWordIndex < selectedList.length) {
                let wordToPlay = selectedList[currentWordIndex].word;
                lastPlayedWord = wordToPlay; // çŸ¢å°ã‚­ãƒ¼ã§å†ç”Ÿã—ãŸå˜èªã‚’è¨˜éŒ²
                playWord(wordToPlay);
            }
        }
    }
});
// Shiftã‚­ãƒ¼å˜ç‹¬ã§æœ€å¾Œã«å†ç”Ÿã—ãŸå˜èªã‚’å†ç”Ÿ
document.addEventListener("keydown", function(event) {
    if (event.key === "Shift" && lastPlayedWord) {
        playWord(lastPlayedWord);
    }
});
// Shiftã‚­ãƒ¼ã®å‡¦ç†
document.addEventListener("keydown", function (event) {
    if (event.key === "Shift" && lastPlayedWord) {
        // ã‚¯ã‚¤ã‚ºä¸­ã‹ã©ã†ã‹ã‚’åˆ¤å®š
        const isQuizActive = !document.getElementById("quiz-section").classList.contains("hidden");

        if (isQuizActive) {
            // ã‚¯ã‚¤ã‚ºä¸­ã®å ´åˆï¼šç¾åœ¨ã®å•é¡Œã®å˜èªã‚’å†ç”Ÿ
            const word = quizWords[currentQuizIndex - 1]; // ç¾åœ¨ã®å•é¡Œã®å˜èªã‚’å–å¾—
            playWord(word.word);
        } else {
            // å˜èªä¸€è¦§è¡¨ç¤ºä¸­ã®å ´åˆï¼šæœ€å¾Œã«å†ç”Ÿã•ã‚ŒãŸå˜èªã‚’å†ç”Ÿ
            if (lastPlayedWord) {
                playWord(lastPlayedWord);
            }
        }
    }
});
// çŸ¢å°ã‚­ãƒ¼ã®å‡¦ç†
document.addEventListener("keydown", function (event) {
  // å…¥åŠ›ä¸­ï¼ˆINPUT/TEXTAREA/contenteditableï¼‰ã¯å¥ªã‚ãªã„
  const t = event.target;
  const typing = t && (t.tagName === 'INPUT' || t.tagName === 'TEXTAREA' || t.isContentEditable);
  if (typing) return;

  const isQuizActive = !document.getElementById("quiz-section").classList.contains("hidden");

  // --- Shiftå˜ç‹¬ï¼šæœ€å¾Œã®å˜èª or ã‚¯ã‚¤ã‚ºä¸­ã¯ç¾åœ¨ã®å˜èªã‚’å†ç”Ÿ ---
  if (event.key === "Shift") {
    if (isQuizActive) {
      // ã‚¯ã‚¤ã‚ºä¸­ï¼šç¾åœ¨ã®å•é¡Œã®å˜èªã‚’å†ç”Ÿ
      if (typeof quizWords !== "undefined" && quizWords[currentQuizIndex - 1]) {
        playWord(quizWords[currentQuizIndex - 1].word);
      }
    } else if (lastPlayedWord) {
      // å˜èªä¸€è¦§è¡¨ç¤ºä¸­ï¼šæœ€å¾Œã«å†ç”Ÿã•ã‚ŒãŸå˜èªã‚’å†ç”Ÿ
      playWord(lastPlayedWord);
    }
    return;
  }

  // --- ã‚¯ã‚¤ã‚ºä¸­ã¯çŸ¢å°ã‚­ãƒ¼ç„¡åŠ¹ ---
  if (isQuizActive) return;

  // --- çŸ¢å°â†‘â†“ï¼šç”»é¢ãƒœã‚¿ãƒ³ã¨åŒã˜å‡¦ç†ã«çµ±ä¸€ ---
 
  // iPad Safariã§ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹é£›ã³é˜²æ­¢
  if (event.key === "ArrowUp" || event.key === "ArrowDown") {
    event.preventDefault();
    event.stopPropagation(); // â†è¿½åŠ ï¼ˆé‡è¦ï¼‰
  }

  if (event.key === "ArrowDown") {
    playNextWord();
  } else if (event.key === "ArrowUp") {
    playPreviousWord();
  }
});

function playPreviousWord() {
    const wordListRows = document.querySelectorAll("#word-list-body tr:not([style*='display: none'])");
    if (wordListRows.length === 0) return; // å˜èªãƒªã‚¹ãƒˆãŒç©ºãªã‚‰ä½•ã‚‚ã—ãªã„

    if (currentWordIndex > 0) {
        currentWordIndex--;
    }
    const prevWord = wordListRows[currentWordIndex]
    playWordAtIndex(currentWordIndex, wordListRows);
    scrollTable("up");
}
function playNextWord() {
    const wordListRows = document.querySelectorAll("#word-list-body tr:not([style*='display: none'])");
    if (currentWordIndex < wordListRows.length - 1) {
        currentWordIndex++;
    }
    playWordAtIndex(currentWordIndex, wordListRows);
    scrollTable("down");
}

// ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é‡ï¼ˆãƒ”ã‚¯ã‚»ãƒ«å˜ä½ï¼‰
const scrollStep = 42;

// è¡¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’è¡Œã†é–¢æ•°
function scrollTable(direction) {
    const scrollableTable = document.getElementById("scrollable-table");
    if (direction === "down") {
        scrollableTable.scrollTop += scrollStep;
    } else if (direction === "up") {
        scrollableTable.scrollTop -= scrollStep;
    }
}

// å˜èªã‚’å†ç”Ÿï¼ˆ`currentWordIndex` ã®å¤‰æ›´ã¯ã“ã“ã§ã¯è¡Œã‚ãªã„ï¼‰
function playWordAtIndex(index, wordListRows) {
    if (!wordListRows || wordListRows.length === 0 || index < 0 || index >= wordListRows.length) return;

    const word = wordListRows[index]
        .querySelector("td:first-child")
        .textContent.trim()
        .replace(/ğŸ“¢/, ""); // ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ã‚¯ã‚’é™¤å»

    playWord(word);
    lastPlayedWord = word;
    currentWordIndex = index;
}

// ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
// document.getElementById("up-button").addEventListener("click", () => {
//     const wordListRows = document.querySelectorAll("#word-list-body tr:not([style*='display: none'])");
//     if (currentWordIndex > 0) {
//         currentWordIndex--;
//     }
//     playWordAtIndex(currentWordIndex, wordListRows);
//     scrollTable("up");
// });
// document.getElementById("down-button").addEventListener("click", () => {
//     const wordListRows = document.querySelectorAll("#word-list-body tr:not([style*='display: none'])");
//     if (currentWordIndex < wordListRows.length - 1) {
//         currentWordIndex++;
//     }
//     playWordAtIndex(currentWordIndex, wordListRows);
//     scrollTable("down");
// });

function repeatLastWord() {
    if (lastPlayedWord) {
        playWord(lastPlayedWord);
    }
}
////////////////////// å˜èªä¸€è¦§ã®è¡¨ç¤ºé–¢æ•°/////////////////////////////////////////////
    // éŸ“å›½èªã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°
    function toggleKorean() {
        const isChecked = document.getElementById("toggle-korean").checked;
        document.querySelectorAll("#word-list-body tr td:first-child").forEach(td => {
            td.classList.toggle("hidden-korean", isChecked);
        });
    }
    // æ„å‘³ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°
    function toggleMeaning() {
        const isChecked = document.getElementById("toggle-meaning").checked;
        document.querySelectorAll("#word-list-body tr td:nth-child(2)").forEach(td => {
            td.classList.toggle("hidden-meaning", isChecked);
        });
    }

function playWordFromSpeaker(word) {
    playWord(word);

    const wordListRows = document.querySelectorAll("#word-list-body tr:not([style*='display: none'])");
    for (let i = 0; i < wordListRows.length; i++) {
        const rowWord = wordListRows[i].querySelector("td:first-child").textContent
            .replace(/ğŸ“¢/, "")
            .trim();
        if (rowWord === word) {
            currentWordIndex = i;
            break;
        }
    }
}

function showSelectedWordList() {
    const level = document.getElementById("wordlist-level-select").value;
    setWordList(level);

    const startPage = parseInt(document.getElementById("wordlist-start-page").value);
    const endPage = parseInt(document.getElementById("wordlist-end-page").value);
    const shuffle = document.getElementById("wordlist-shuffle").checked;

    const filteredWords = selectedList.filter(word => word.page >= startPage && word.page <= endPage);
    if (shuffle) {
        filteredWords.sort(() => Math.random() - 0.5);
    }

    showWordList(filteredWords, level);
    
    rebuildHiddenChips();                 // â† ãƒãƒƒãƒ—ã‚’å†ç”Ÿæˆ
    requestAnimationFrame(updateWordSummary); // â† é›†è¨ˆã‚‚æ›´æ–°
}
// âœ… é–‹å§‹ã‚’å¤‰ãˆãŸã‚‰çµ‚äº†ã‚‚åŒã˜ãƒšãƒ¼ã‚¸ã«è‡ªå‹•åŒæœŸï¼ˆå³ã‚’å·¦ã«æƒãˆã‚‹ï¼‰
function syncEndToStart(startId, endId) {
  const s = document.getElementById(startId);
  const e = document.getElementById(endId);
  if (!s || !e) return;
  e.value = s.value;                       // å³ã‚’å·¦ã«æƒãˆã‚‹
  e.dispatchEvent(new Event("change"));    // ä¾å­˜å‡¦ç†ãŒã‚ã‚Œã°ç™ºç«
}

// âœ… å·¦(é–‹å§‹)ã¨å³(çµ‚äº†)ã®é€£å‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
function setupLinkedPageSelectors(startId, endId) {
  const startSel = document.getElementById(startId);
  const endSel   = document.getElementById(endId);
  if (!startSel || !endSel) return;

  // å·¦ã‚’å¤‰ãˆãŸã‚‰å³ã‚’åŒæœŸï¼†ç¯„å›²åˆ¶é™
  startSel.addEventListener("change", () => {
    const startVal = parseInt(startSel.value, 10);
    const options  = [...endSel.querySelectorAll("option")];

    // â‘  å³ã®é¸æŠè‚¢ã‹ã‚‰ã€å·¦ã‚ˆã‚Šå°ã•ã„ãƒšãƒ¼ã‚¸ã‚’éè¡¨ç¤ºï¼ˆæ¶ˆã™ï¼‰
    options.forEach(opt => {
      const v = parseInt(opt.value, 10);
      if (isNaN(v)) return;
      opt.hidden = v < startVal;
    });

    // â‘¡ ç¾åœ¨ã®å³ã®å€¤ãŒå·¦ã‚ˆã‚Šå°ã•ã„å ´åˆã¯è‡ªå‹•ã§æƒãˆã‚‹
    const endVal = parseInt(endSel.value, 10);
    if (isNaN(endVal) || endVal < startVal) {
      endSel.value = startSel.value;
    }
  });
}

// âœ… ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ä¸€åº¦ã ã‘åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', () => {
  setupLinkedPageSelectors('wordlist-start-page', 'wordlist-end-page');
  setupLinkedPageSelectors('start-page', 'end-page');
});

document.addEventListener('DOMContentLoaded', () => {
  setupLinkedPageSelectors('wordlist-start-page', 'wordlist-end-page');
  setupLinkedPageSelectors('start-page', 'end-page');
});

function setupLinkedPageSelectors(startId, endId) {
  const startSel = document.getElementById(startId);
  const endSel   = document.getElementById(endId);
  if (!startSel || !endSel) return;

  // âœ… åˆå›ã«å³å´ã®å…¨<option>ã‚’ä¸¸ã”ã¨é€€é¿ï¼ˆã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ä¿æŒï¼‰
  if (!endSel._allOptions) {
    endSel._allOptions = Array.from(endSel.options).map(o => o.cloneNode(true));
  }

  const rebuild = () => {
    const startVal = parseInt(startSel.value, 10);
    if (isNaN(startVal)) return;

    // âœ… é€€é¿ã—ã¦ãŠã„ãŸå…¨å€™è£œã‹ã‚‰ã€å·¦ä»¥ä¸Šã®ã‚‚ã®ã ã‘ã§å³<select>ã‚’å†ç”Ÿæˆ
    endSel.innerHTML = '';
    const frag = document.createDocumentFragment();
    for (const opt of endSel._allOptions) {
      const v = parseInt(opt.value, 10);
      if (isNaN(v) || v >= startVal) {
        frag.appendChild(opt.cloneNode(true)); // ã‚¯ãƒ­ãƒ¼ãƒ³ã§æŒ¿å…¥
      }
    }
    endSel.appendChild(frag);

    // å³ã®ç¾åœ¨å€¤ãŒå°ã•ã™ãã‚‹/æœªè¨­å®šãªã‚‰ã€å·¦ã«æƒãˆã‚‹
    const endVal = parseInt(endSel.value, 10);
    if (isNaN(endVal) || endVal < startVal) {
      endSel.value = String(startVal);
    }

    // å¿…è¦ãªã‚‰ä¾å­˜å‡¦ç†ã‚’ç™ºç«
    endSel.dispatchEvent(new Event('change'));
  };

  // å·¦å¤‰æ›´æ™‚ã«å³ã‚’å†æ§‹ç¯‰
  startSel.addEventListener('change', rebuild);

  // åˆæœŸè¡¨ç¤ºã§ã‚‚ä¸€åº¦åŒæœŸï¼ˆä»»æ„ã ãŒã‚ªã‚¹ã‚¹ãƒ¡ï¼‰
  rebuild();
}

// å˜èªä¸€è¦§è¡¨ç¤ºé–¢æ•°ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ãƒ‡ãƒ¼ã‚¿ã‚’é©ç”¨ï¼‰
function showWordList(filteredWords, level) {
    currentWordIndex = 0;
    loadAnswersFromStorage();
    hideAllSections();

    let shuffleCheckbox = document.getElementById("wordlist-shuffle");
    if (!shuffleCheckbox) return;

    if (shuffleCheckbox.checked) {
        filteredWords = [...filteredWords].sort(() => Math.random() - 0.5);
    }

    const wordListBody = document.getElementById("word-list-body");
    wordListBody.innerHTML = "";

    filteredWords.forEach(word => {
        let statusClass = "";
        let statusText = "";
        if (word.status === "æš—è¨˜æ¸ˆ") {
            statusClass = "green";
            statusText = "ã€‡";
        } else if (word.status === "æœªæš—è¨˜") {
            statusClass = "red";
            statusText = "Ã—";
        }

        const row = document.createElement("tr");
        row.innerHTML = `
            <td class="col-word">${word.word}  
                <span onclick="playWordFromSpeaker('${word.word}')" style="font-size: 12px; cursor: pointer;">ğŸ“¢</span>
            </td>
            <td class="col-meaning">${word.meaning}</td>
            <td class="${statusClass}" onclick="toggleWordStatus(this, '${word.word}')">${statusText}</td>
        `;
        wordListBody.appendChild(row);
    });

    filterWordList();
    document.getElementById("word-list").classList.remove("hidden");
}

function toggleWordStatus(cell, wordText) {
    let currentStatus = cell.textContent.trim();
    let newStatus = "";
    let newClass = "";

    if (currentStatus === "ã€‡") {
        newStatus = "Ã—";
        newClass = "red";
    } else if (currentStatus === "Ã—") {
        newStatus = "";
        newClass = "";
    } else {
        newStatus = "ã€‡";
        newClass = "green";
    }

    // ã‚»ãƒ«ã®è¦‹ãŸç›®ã‚’æ›´æ–°
    cell.textContent = newStatus;
    cell.className = newClass;

    // ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ›´æ–°
    const wordObj = selectedList.find(w => w.word === wordText);
    if (wordObj) {
        if (newStatus === "ã€‡") {
            wordObj.status = "æš—è¨˜æ¸ˆ";
        } else if (newStatus === "Ã—") {
            wordObj.status = "æœªæš—è¨˜";
        } else {
            delete wordObj.status;
        }
    }

    // localStorageã«ä¿å­˜
    let storedAnswers = JSON.parse(localStorage.getItem('quizAnswers')) || [];
    const existing = storedAnswers.find(a => a.word === wordText);
    if (existing) {
        if (newStatus === "") {
            storedAnswers = storedAnswers.filter(a => a.word !== wordText);
        } else {
            existing.status = newStatus === "ã€‡" ? "æš—è¨˜æ¸ˆ" : "æœªæš—è¨˜";
        }
    } else if (newStatus !== "") {
        storedAnswers.push({
            word: wordText,
            status: newStatus === "ã€‡" ? "æš—è¨˜æ¸ˆ" : "æœªæš—è¨˜"
        });
    }
    localStorage.setItem("quizAnswers", JSON.stringify(storedAnswers));

    // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒæœ‰åŠ¹ãªå ´åˆã¯å†é©ç”¨
    // filterWordList();
}

document.addEventListener("DOMContentLoaded", function () {
  const btn = document.getElementById("word-list-show-btn");
  if (btn) {
    btn.addEventListener("click", showSelectedWordList); 
  }
});

document.addEventListener("DOMContentLoaded", function () {
    const scrollableTable = document.getElementById("scrollable-table");

    // iPadã§ã‚‚ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’å½“ã¦ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
    scrollableTable.addEventListener("click", () => {
        scrollableTable.focus();
    });

});

// document.addEventListener('DOMContentLoaded', function() {
//     // ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’ã“ã“ã§è¿½åŠ 
//     document.getElementById("intermediate-word-list-btn").addEventListener("click", showIntermediateWordList);
//     document.getElementById("beginner-word-list-btn").addEventListener("click", showBeginnerWordList);
//     document.getElementById("start
        

// ç¯„å›²ã‚’åŸºã«å˜èªä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
function showFilteredWordList() {
    const startPage = parseInt(wordListStartPageSelect.value);
    const endPage = parseInt(wordListEndPageSelect.value);
    if (startPage > endPage) {
        alert("é–‹å§‹ãƒšãƒ¼ã‚¸ã¯çµ‚äº†ãƒšãƒ¼ã‚¸ä»¥ä¸‹ã«ã—ã¦ãã ã•ã„ã€‚");
        return;
    }
    // ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹ãƒªã‚¹ãƒˆã‚’å–å¾—
    const filteredWords = selectedList.filter(word => word.page >= startPage && word.page <= endPage);
    if (filteredWords.length === 0) {
        alert("é¸æŠç¯„å›²å†…ã«å˜èªãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
        return;
    }
    showWordList(filteredWords);
}
function filterWordList() {
    const hideCorrect = document.getElementById("hide-correct").checked;
    const hideIncorrect = document.getElementById("hide-incorrect").checked;
    const hideUnattempted = document.getElementById("hide-unattempted").checked;
    const wordListBody = document.getElementById("word-list-body");
    const rows = wordListBody.querySelectorAll("tr");

    rows.forEach(row => {
        const correctCell = row.querySelector("td:nth-child(3)"); // æ­£è§£/ä¸æ­£è§£çŠ¶æ…‹ã‚’è¡¨ç¤ºã™ã‚‹ã‚»ãƒ«
        const statusText = correctCell.textContent;
        let hideRow = false;
        if (hideCorrect && statusText === "ã€‡") {
            hideRow = true;
        }
        if (hideIncorrect && statusText === "Ã—") {
            hideRow = true;
        }
        if (hideUnattempted && statusText === "") {
            hideRow = true;
        }
        // è¡Œã‚’éè¡¨ç¤ºã«ã™ã‚‹
        row.style.display = hideRow ? "none" : "";
    });
}
        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function showRangeSelection() {
            hideAllSections();
            document.getElementById("range-selection").classList.remove("hidden");
        }
        function showQuizSection() {
            hideAllSections();
            document.getElementById("quiz-section").classList.remove("hidden");
        }
        function hideAllSections() {
            document.querySelectorAll(".section, .table-container").forEach(section => {
                section.classList.add("hidden");
            });
        }
        showRangeSelection();
        
		function updateWordSummary(){
		  const tbody = document.getElementById('word-list-body');
		  if(!tbody) return;

		  const rowsAll = [...tbody.querySelectorAll('tr')];

		  const countBy = (rows) => {
		    let done=0, not=0, none=0;
		    rows.forEach(tr=>{
		      const td = tr.querySelector('td:nth-child(3)');
		      if(!td) return;
		      const txt = td.textContent.trim();
		      if (txt === 'ã€‡' || td.classList.contains('green')) done++;
		      else if (txt === 'Ã—' || td.classList.contains('red')) not++;
		      else none++;
		    });
		    return {done, not, none, total: done+not+none};
		  };

		  // âœ… è¡¨ç¤º/éè¡¨ç¤ºã«é–¢ä¿‚ãªãå…¨ä½“ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
		  const c = countBy(rowsAll);

		  // æ›´æ–°
		  document.querySelector('.status-item.green b').textContent = c.done;
		  document.querySelector('.status-item.red b').textContent   = c.not;
		  document.querySelector('.status-item.gray b').textContent  = c.none;
		  document.querySelector('.summary-total b').textContent     = c.total;

		  const total = c.total || 1; // 0é™¤ç®—é˜²æ­¢
		  document.getElementById('bar-done').style.width = (c.done/total*100)+'%';
		  document.getElementById('bar-not').style.width  = (c.not/total*100)+'%';
		  document.getElementById('bar-none').style.width = (c.none/total*100)+'%';
		}
				// --- è‡ªå‹•æ›´æ–°ãƒ•ãƒƒã‚¯ ---
			['showWordList','toggleWordStatus','filterWordList'].forEach(fn=>{
			  const orig = window[fn];
			  if(typeof orig==='function'){
			    window[fn] = function(){
			      const r = orig.apply(this, arguments);
			      requestAnimationFrame(updateWordSummary);
			      return r;
			    };
			  }
			});

// âœ… ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ON/OFFã§å³åæ˜ ï¼ˆæ§‹é€ ã«ä¾å­˜ã—ãªã„ï¼‰
document.addEventListener("DOMContentLoaded", () => {
  const ids = ["hide-correct", "hide-incorrect", "hide-unattempted"];
  ids.forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    el.addEventListener("change", () => {
      if (typeof filterWordList === "function") filterWordList();
      requestAnimationFrame(updateWordSummary);
    });
  });
});


document.addEventListener('DOMContentLoaded', () => {
  const wrap = document.getElementById('scrollable-table');
  const tbody = document.getElementById('word-list-body');

  const chkWord    = document.getElementById('toggle-col-word');
  const chkMeaning = document.getElementById('toggle-col-meaning');

  // åˆ—ã®ä¸€æ‹¬éè¡¨ç¤ºãƒˆã‚°ãƒ«
  chkWord?.addEventListener('change', () => {
    wrap.classList.toggle('hide-col-word', chkWord.checked);
    clearPeek('word');
  });
  chkMeaning?.addEventListener('change', () => {
    wrap.classList.toggle('hide-col-meaning', chkMeaning.checked);
    clearPeek('meaning');
  });

  // ã‚»ãƒ«å€‹åˆ¥ãƒˆã‚°ãƒ«ï¼ˆéš ã‚Œã¦ã„ã‚‹ã¨ãã ã‘åŠ¹ãï¼‰
  tbody?.addEventListener('click', (e) => {
    const td = e.target.closest('td');
    if (!td) return;

    // å˜èªåˆ—
    if (wrap.classList.contains('hide-col-word') && td.classList.contains('col-word')) {
      e.stopPropagation(); // ä»–ã®ã‚¯ãƒªãƒƒã‚¯å‡¦ç†ï¼ˆç™ºéŸ³å†ç”Ÿãªã©ï¼‰ã‚’æ­¢ã‚ã‚‹
      td.classList.toggle('peek-cell');
      return;
    }
    // æ„å‘³åˆ—
    if (wrap.classList.contains('hide-col-meaning') && td.classList.contains('col-meaning')) {
      e.stopPropagation();
      td.classList.toggle('peek-cell');
      return;
    }
  });

  function clearPeek(which){
    const sel = which === 'word' ? 'td.col-word.peek-cell' : 'td.col-meaning.peek-cell';
    document.querySelectorAll(sel).forEach(td => td.classList.remove('peek-cell'));
  }
});

////ãƒ•ã‚¡ã‚¤ãƒ«é€²æ—å‡ºåŠ›///////////////////////////////////////////////////////////////////////////
function exportProgress() {
    const answers = JSON.parse(localStorage.getItem("quizAnswers")) || [];
    const jsonString = JSON.stringify(answers, null, 2);

    const outputArea = document.getElementById("json-output");
    const textArea = document.getElementById("json-text");

    textArea.value = jsonString;
    outputArea.classList.remove("hidden");
    textArea.scrollTop = 0;
    textArea.select(); // è‡ªå‹•ã§å…¨é¸æŠ

    showToast("ã‚³ãƒ”ãƒ¼ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ï¼");
}

function importProgress(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
        try {
            const data = JSON.parse(e.target.result);
            if (Array.isArray(data)) {
                localStorage.setItem("quizAnswers", JSON.stringify(data));
                showToast("æš—è¨˜çŠ¶æ³ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼");
                setTimeout(() => location.reload(), 1000);
            } else {
                alert("ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚");
            }
        } catch (error) {
            alert("èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚JSONå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚");
        }
    };
    reader.readAsText(file);
}

function copyToClipboard() {
    const textArea = document.getElementById("json-text");
    textArea.select();
    document.execCommand("copy");
    showToast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
}

function showToast(message, duration = 3000) {
    const toast = document.getElementById("toast");
    if (!toast) return;

    toast.textContent = message;
    toast.classList.add("show");

    setTimeout(() => {
        toast.classList.remove("show");
    }, duration);
}
</script>
</div></body>
</html>
